
# AWS IAM

## IAM Basics
- IAM (Identity and Access Management) is a `global` AWS service that controls access to AWS resources.
- Every AWS account starts with a root user, but it should never be used or shared for daily operations.
- IAM is built around the principle of least privilege so that identities receive only the permissions they require.

## Users and Groups
- **Root user**: created with the account. Protect it with MFA and store the credentials securely.
- **IAM users**: represent people or applications that sign in via the Console, CLI, or SDK.
- **IAM groups**: role-based collections such as Dev, Ops, or Audit teams within your organisation. Groups contain only users and cannot nest.
- **Why create them?** To grant the right level of permissions to identities and maintain secure access to AWS resources across the organisation.

## Permissions and Policies
- Permissions are defined in JSON IAM policies that can attach to `users`, `groups`, or `roles`.
- Policy types:
  - **AWS managed**: maintained by AWS (e.g., `AdministratorAccess`).
  - **Customer managed**: authored and versioned within your account.
  - **Inline policies**: embedded directly in one identity; not reusable.
  - **Permission boundaries**: set the maximum permissions an identity can receive.

### Sample IAM Policy Structure
```json
{
  "Version": "2012-10-17",
  "Statement": [                // one or more individual statements (required)
    {
      "Sid": "AllowS3ReadWrite",
      "Effect": "Allow",
      "Principal": {
        "AWS": ["arn:aws:iam::123456789012:root"]
      },
      "Action": [
        "s3:GetObject",
        "s3:PutObject"
      ],
      "Resource": "arn:aws:s3:::mybucket/*",
      "Condition": {
        "Bool": { "aws:SecureTransport": "true" }
      }
    }
  ]
}
```

### Policy Evaluation Logic
1. If an explicit **Deny** exists, access is denied immediately.
2. If at least one **Allow** exists and no explicit Deny, access is granted.
3. Without any matching Allow, the default outcome is Deny.

## Creating Users and Groups
1. Open the **IAM Dashboard** in the AWS Console.
2. Navigate to **Access Management > Users** and choose **Create user**.
3. Enter user details, add to an existing group or create a new group with the required policies.
4. Add optional tags and create the user.
5. To create groups, go to **Access Management > Groups** and follow a similar flow to attach policies.

## Password Policies and MFA
- Organisation-wide password policy recommendations:
  - Minimum length, mixed character classes (upper/lowercase, digits, symbols).
  - Allow IAM users to change their own passwords.
  - Enforce periodic password rotation.
  - Prevent reuse of recent passwords.
- Multi-Factor Authentication (MFA) options:
  - Virtual apps (Google Authenticator, Authy).
  - Security keys (U2F/FIDO2 hardware).
  - Hardware TOTP tokens (Gemalto, SurePassID, etc.).

## Ways to Access AWS
- **AWS Management Console**: GUI secured with password plus MFA.
- **AWS CLI**: command-line tool requiring access keys.
- **AWS SDK**: programmatic access from applications.
- Reference: Access Key ID acts like a username; Secret Access Key functions like a password.

## Creating Access Keys and Configuring the CLI
1. In **IAM > Access Management > Users**, pick the target user.
2. Under the **Security credentials** tab, choose **Access keys > Create access key**.
3. Select the use case (CLI, local code, etc.) and generate the key pair.
4. Download the `.csv` file immediately and store it securely (you cannot retrieve the secret again).
5. Run Terminal
6. Run `aws configure` and provide:
   - Access Key ID and Secret Access Key
   - Default Region (e.g., `ap-southeast-1`)
   - Output format (optional, e.g., `json`)
7. Validate with `aws iam list-users`.
8. Check the CLI version with `aws --version`.

## AWS CloudShell
- Browser-based managed terminal with the AWS CLI preinstalled.
- Launch it via the `[>_]` icon in the Console header.
- Not available in every Region—consult the [official list](https://docs.aws.amazon.com/cloudshell/latest/userguide/supported-aws-regions.html).

## IAM Roles
- Temporary security principals that delegate permissions to AWS services or external identities.
- Common uses: EC2 instance profiles, Lambda execution roles, cross-account access.
- Creation workflow:
  1. Go to **IAM > Access Management > Roles** and click **Create role**.
  2. Choose the trusted entity (AWS service, another AWS account, web identity, SAML, or custom trust policy).
  3. Select a use-case template and attach the needed permission policies.
  4. Name the role, add an optional description, and create it.

## IAM Security Tools and Monitoring
- **IAM Credentials Report** (account level): CSV overview of all users’ passwords and keys for audits.
- **Access Advisor / Last Access** (user level): shows when services were last used to help remove unused permissions.
- **IAM Access Analyzer**: detects resources that are shared with external principals.
- **AWS CloudTrail**: records IAM changes and API activity for forensic tracking.

## Additional Best Practices
- Always enable MFA on the root account and delete its access keys.
- Favour roles over long-lived access keys; do not hardcode credentials in applications.
- Review Credential Reports and Access Advisor regularly to prune excess permissions.
- Use AWS Organizations and Service Control Policies (SCPs) to enforce guardrails across accounts.
